<!DOCTYPE >
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Catchment-Editor-Discussion</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@latest/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.css" />


    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/vuex"></script>

    <script src="https://unpkg.com/leaflet@latest/dist/leaflet.js"></script>
    <script src="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.min.js"></script>
  	<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6.5.0/turf.min.js"></script>

	<style>
	html,
	body { font-family: Arial, Verdana; background-color: #eef1ef; font-size: 16px; }
	html,
	body { width: 100%; height: 100%; margin: 0;}
	  .wrapper { width: 100%; }
	  .map { height: 100%; }

    .box {height: 200px; width: 200px; text-align: center;}
    .red { background-color: red; }
    .green { background-color: green; }
	</style>

  <!-- https://medium.com/@marcel.leusch/use-vue-3-single-file-components-without-compilation-ac2ccb5f15c2 -->
  <!-- https://overclocked.medium.com/adding-vue-js-to-an-existing-project-ed2d040f870b -->

</head>
  <body>  
  <div id="app">
      <!--colored-box class="red" v-show="display == 'redbox'"></colored-box-->
      <!--colored-box class="green" v-show="display == 'greenbox'"></colored-box-->
	  <leaflet-map></leaflet-map>

    <!--my-button></my-button-->
    </div>
 
	</div>
	
    <!--script src="https://unpkg.com/leaflet@latest/dist/leaflet.js"></script-->
    <!--script src="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.min.js"></script-->
		
<script>
  var CATCHMENTID = 0
  var CATCHMENTS = [{
        "type":"FeatureCollection",
        "features":[{
          "type":"Feature",
          "properties":{"DCORegion":"Q79","stroke-opacity":1,"OrgLongitude":"1.162381","OrgLatitude":"52.057365","name":"D83074 - ORCHARD MEDICAL PRACTICE","Region":"Y55","CCGCode":"06L","ODSCode":"D83074","fill-opacity":0,"stroke":"#0000FF"},
          "geometry":{
            "type":"Polygon",
            "coordinates":[[[1.14189,52.05168],[1.14139,52.05189],[1.1409,52.05305],[1.14,52.0541],[1.13886,52.05427],[1.13785,52.05404],[1.13684,52.05433],
            [1.13508,52.05586],[1.13519,52.05658],[1.13472,52.05729],[1.13448,52.05743],[1.13453,52.05978],[1.13463,52.06311],[1.1409,52.06497],[1.14103,52.06522],
            [1.14111,52.06528],[1.14178,52.06527],[1.14081,52.06531],[1.14094,52.06507],[1.14167,52.06449],[1.14145,52.06528],[1.14137,52.06473],[1.13494,52.06309],
            [1.15227,52.07892],[1.16266,52.08087],[1.16849,52.08129],[1.17433,52.08143],[1.19836,52.08024],[1.20338,52.08013],[1.20819,52.08011],[1.21828,52.08035],
            [1.23059,52.07755],[1.23411,52.07652],[1.23806,52.07602],[1.23016,52.07726],[1.23085,52.07739],[1.23133,52.07718],[1.24428,52.07457],[1.24385,52.06654],
            [1.24286,52.06315],[1.23931,52.05892],[1.23995,52.05283],[1.25325,52.05006],[1.25877,52.04561],[1.25467,52.03821],[1.25591,52.041],[1.25351,52.03567],
            [1.25574,52.04069],[1.25608,52.04061],[1.25385,52.04597],[1.25357,52.04535],[1.24643,52.04663],[1.23986,52.05294],[1.24647,52.0466],[1.26119,52.04346],
            [1.25484,52.03813],[1.2551,52.03892],[1.25879,52.04594],[1.25372,52.03535],[1.25394,52.03561],[1.25845,52.03464],[1.25767,52.03179],[1.25707,52.02918],
            [1.25536,52.02693],[1.2533,52.02656],[1.24918,52.02778],[1.24506,52.02788],[1.24257,52.02754],[1.23999,52.02672],[1.23398,52.02461],[1.23188,52.02421],
            [1.22978,52.02416],[1.22789,52.0244],[1.2218,52.02537],[1.21888,52.02564],[1.21549,52.02572],[1.20759,52.02537],[1.19742,52.02376],[1.1945,52.02347],
            [1.19068,52.02342],[1.18725,52.02384],[1.18394,52.0245],[1.17965,52.02617],[1.17725,52.0267],[1.17422,52.02693],[1.1705,52.03149],[1.15952,52.03346],
            [1.15976,52.03377],[1.15918,52.0338],[1.15998,52.03404],[1.16007,52.03406],[1.16127,52.03419],[1.16057,52.03381],[1.16017,52.03384],[1.16009,52.03388],
            [1.15566,52.0364],[1.157167,52.046473],[1.148587,52.051118],[1.15116,52.054179],[1.147729,52.05154],[1.152705,52.04869],[1.143268,52.054602],
            [1.150989,52.048479],[1.148758,52.047423],[1.148758,52.04774],[1.153048,52.052174],[1.151161,52.04679],[1.14773,52.053335],[1.152533,52.044362],
            [1.15339,52.044467],[1.143441,52.053757],[1.154076,52.044573],[1.152703,52.044573],[1.153047,52.04415],[1.153047,52.044678],[1.155276,52.044995],
            [1.153903,52.044467],[1.153218,52.044467],[1.148238,52.046104],[1.153471,52.04642],[1.149953,52.044731],[1.151497,52.047107],[1.149438,52.044731],
            [1.154594,52.051224],[1.154242,52.04415],[1.15184,52.045417],[1.154413,52.044889],[1.149781,52.044995],[1.153556,52.04415],[1.154933,52.044784],
            [1.154246,52.045628],[1.152188,52.044467],[1.146531,52.051118],[1.138123,52.055341],[1.141726,52.054179],[1.153388,52.044889],[1.153388,52.044678],
            [1.152698,52.044784],[1.153388,52.044362],[1.153731,52.044889],[1.155104,52.044362],[1.154247,52.044784],[1.156305,52.047212],[1.154585,52.044573],
            [1.152874,52.045312],[1.154761,52.044256],[1.145672,52.053757],[1.153045,52.044889],[1.153384,52.044784],[1.144128,52.053652],[1.153212,52.044467],
            [1.152869,52.044678],[1.153898,52.044995],[1.149782,52.044678],[1.153732,52.045206],[1.153383,52.044467],[1.149437,52.044731],[1.153391,52.052913],
            [1.149094,52.045523],[1.150639,52.046367],[1.149609,52.047001],[1.149008,52.046948],[1.150296,52.044678],[1.151067,52.046579],[1.147037,52.04774],
            [1.149695,52.045523],[1.150037,52.045153],[1.151068,52.047423],[1.141807,52.052121],[1.146696,52.051277],[1.143265,52.051857],[1.146353,52.051118],
            [1.14601,52.05096],[1.148068,52.049799],[1.14655,52.0486],[1.148841,52.050907],[1.149437,52.047846],[1.149269,52.046631],[1.151582,52.04737],
            [1.141377,52.053018],[1.152096,52.044573],[1.151067,52.045734],[1.150037,52.047529],[1.148923,52.047265],[1.148322,52.047582],[1.149781,52.045734],
            [1.147122,52.047529],[1.150382,52.05096],[1.150469,52.050274],[1.150898,52.050643],[1.14558,52.051593],[1.140778,52.053652],[1.14637,52.04904],
            [1.1474,52.0496],[1.14916,52.04977],[1.15081,52.0501],[1.15114,52.05047],[1.15262,52.05077],[1.15315,52.05159],[1.15047,52.05131],[1.14601,52.05123],
            [1.14298,52.05183],[1.14189,52.05168],[1.14189,52.05168]]]
          }
        }
      ]},
      
      { "type":"FeatureCollection",
        "features":[{
          "type":"Feature",
          "properties":{"name":"L83111 - CHILCOTE PRACTICE","ODSCode":"L83111","CCGCode":"99Q","DCORegion":"Q85","OrgLatitude":"50.468526","OrgLongitude":"-3.582818","PolygonPointCount":563,"PolygonIntersectionCount":391},"geometry":{"type":"Polygon","coordinates":[[[-3.5069,50.51977],[-3.50664,50.52013],[-3.50682,50.52051],[-3.50646,50.52081],[-3.50632,50.52106],[-3.50633,50.5212],[-3.5064,50.52128],[-3.50644,50.5214],[-3.50642,50.52148],[-3.50633,50.52168],[-3.50601,50.52205],[-3.50576,50.52246],[-3.50553,50.52269],[-3.51148,50.52427],[-3.51399,50.52499],[-3.51658,50.52586],[-3.51774,50.52661],[-3.51849,50.52747],[-3.51988,50.52798],[-3.52058,50.52821],[-3.52127,50.52811],[-3.52128,50.5285],[-3.5218,50.52864],[-3.52242,50.52889],[-3.52322,50.52918],[-3.52473,50.5296],[-3.52553,50.5297],[-3.52633,50.52991],[-3.52818,50.53014],[-3.53261,50.53014],[-3.53524,50.52933],[-3.53782,50.52833],[-3.54356,50.52431],[-3.54782,50.52162],[-3.54714,50.51916],[-3.54729,50.51806],[-3.54718,50.5175],[-3.54664,50.51704],[-3.54618,50.5164],[-3.54547,50.51597],[-3.54574,50.51561],[-3.54541,50.51454],[-3.54663,50.51273],
          [-3.54874,50.51181],[-3.55086,50.51171],[-3.55185,50.51178],[-3.55285,50.51153],[-3.55424,50.51087],[-3.553177,50.51033],[-3.552985,50.50995],
          [-3.549168,50.508636],[-3.551806,50.50966],[-3.547137,50.50868],[-3.543821,50.507095],[-3.54071,50.50034],[-3.544721,50.49645],[-3.54062,50.500324],
          [-3.542851,50.503273],[-3.542165,50.50617],[-3.541034,50.49997],[-3.553584,50.495193],[-3.560728,50.491043],[-3.564806,50.485897],[-3.564644,50.487602],
          [-3.564901,50.48733],[-3.560172,50.492928],[-3.563786,50.48957],[-3.556653,50.494495],[-3.554744,50.49496],[-3.551912,50.494495],[-3.546334,50.49611],
          [-3.550279,50.494633],[-3.572508,50.4852],[-3.57105,50.485664],[-3.569591,50.486946],[-3.56839,50.486565],[-3.566309,50.486263],[-3.573516,50.484055],
          [-3.571221,50.48575],[-3.569276,50.483616],[-3.572166,50.484097],[-3.573559,50.484177],[-3.57185,50.484055],[-3.573438,50.483562],[-3.573138,50.48165],
          [-3.575133,50.483864],[-3.574875,50.483345],[-3.574747,50.482334],[-3.576248,50.482536],[-3.576371,50.48142],[-3.57693,50.481144],[-3.578088,50.479958],
          [-3.579228,50.480434],[-3.578756,50.48153],[-3.573053,50.484383],[-3.575799,50.48187],[-3.575327,50.482906],[-3.579788,50.48135],[-3.577944,50.48001],
          [-3.578434,50.48127],[-3.579145,50.48198],[-3.5764,50.481514],[-3.580151,50.480392],[-3.579912,50.479683],[-3.57966,50.480312],[-3.580947,50.47907],
          [-3.580433,50.47981],[-3.581996,50.479576],[-3.582021,50.478645],[-3.581764,50.47907],[-3.579706,50.48064],[-3.58125,50.479233],[-3.58056,50.479507],
          [-3.579405,50.479958],[-3.58007,50.480545],[-3.581186,50.478497],[-3.582644,50.477337],[-3.582366,50.47758],[-3.582388,50.479725],[-3.582324,50.47526],
          [-3.58316,50.47687],[-3.582431,50.476463],[-3.582538,50.474277],[-3.582752,50.476025],[-3.582967,50.467037],[-3.581508,50.473404],[-3.580908,50.469498],
          [-3.581972,50.469387],[-3.580436,50.470726],[-3.583259,50.470154],[-3.582752,50.46974],[-3.582658,50.472828],[-3.582193,50.46944],[-3.581677,50.47302],
          [-3.583608,50.46887],[-3.583479,50.467693],[-3.583559,50.466084],[-3.585624,50.46409],[-3.591029,50.46103],[-3.584589,50.464497],[-3.592102,50.459965],
          [-3.590429,50.460236],[-3.59,50.459198],[-3.591072,50.459007],[-3.588713,50.461628],[-3.589142,50.460728],[-3.590514,50.459717],[-3.590772,50.46021],
          [-3.590257,50.45857],[-3.590084,50.461193],[-3.592187,50.45857],[-3.588026,50.459854],[-3.593517,50.460293],[-3.594676,50.45887],[-3.594333,50.459473],
          [-3.594547,50.4595],[-3.593903,50.458595],[-3.595449,50.458267],[-3.588156,50.459637],[-3.597765,50.45843],[-3.596307,50.457256],[-3.597852,50.458733],
          [-3.590516,50.459034],[-3.590216,50.45906],[-3.598709,50.458187],[-3.598924,50.45532],[-3.600254,50.45532],[-3.60137,50.45682],[-3.601499,50.45532],
          [-3.591113,50.45379],[-3.6044,50.45609],[-3.584341,50.45488],[-3.60334,50.45575],[-3.589273,50.454716],[-3.60262,50.45526],[-3.601971,50.454254],
          [-3.601026,50.454117],[-3.600683,50.454445],[-3.59738,50.45362],[-3.59604,50.45462],[-3.59501,50.45392],[-3.587897,50.4545],[-3.583091,50.4557],
          [-3.579873,50.455727],[-3.581932,50.454525],[-3.580945,50.45559],[-3.579143,50.455482],[-3.579229,50.453762],[-3.58133,50.454254],[-3.576268,50.4545],
          [-3.575538,50.454308],[-3.580557,50.454636],[-3.579956,50.45417],[-3.577639,50.45409],[-3.577939,50.454662],[-3.573607,50.45461],[-3.58386,50.45409],
          [-3.57545,50.455128],[-3.569917,50.455864],[-3.576396,50.45537],[-3.57515,50.454117],[-3.575322,50.454826],[-3.582487,50.45458],[-3.58386,50.454773],
          [-3.582916,50.454117],[-3.582916,50.454117],[-3.583345,50.455345],[-3.584459,50.45499],[-3.581757,50.454388],[-3.579311,50.454445],[-3.578968,50.454853],
          [-3.579482,50.45417],[-3.57695,50.453953],[-3.574204,50.455265],[-3.572917,50.45409],[-3.573003,50.4545],[-3.576263,50.454742],[-3.575748,50.45461],
          [-3.574331,50.455563],[-3.575362,50.454144],[-3.568669,50.455673],[-3.574975,50.454445],[-3.571628,50.454853],[-3.566351,50.45488],[-3.566309,50.454254],
          [-3.566866,50.454937],[-3.565579,50.455536],[-3.565708,50.454445],[-3.566394,50.45562],[-3.566266,50.454964],[-3.567167,50.45461],[-3.566737,50.4554],
          [-3.565107,50.45455],[-3.566051,50.4557],[-3.567038,50.45529],[-3.567982,50.454308],[-3.567167,50.455647],[-3.567081,50.45458],[-3.564121,50.45551],
          [-3.564463,50.455265],[-3.565064,50.455425],[-3.563906,50.454742],[-3.56575,50.45442],[-3.56575,50.455673],[-3.566609,50.45499],[-3.570041,50.454773],
          [-3.566351,50.454853],[-3.566094,50.45461],[-3.566351,50.45458],[-3.564292,50.45589],[-3.566909,50.455128],[-3.56854,50.45461],[-3.57077,50.45562],
          [-3.568454,50.4551],[-3.568111,50.4548],[-3.569225,50.455235],[-3.568196,50.455917],[-3.56545,50.455536],[-3.566565,50.4551],[-3.565492,50.455044],
          [-3.565535,50.45622],[-3.563004,50.455753],[-3.562618,50.45614],[-3.564077,50.454773],[-3.562875,50.455563],[-3.56176,50.45581],[-3.562403,50.455456],
          [-3.5597,50.456303],[-3.558155,50.45559],[-3.555451,50.45589],[-3.555108,50.45562],[-3.556267,50.455784],[-3.560771,50.455536],[-3.559141,50.455208],
          [-3.558369,50.455647],[-3.559655,50.455425],[-3.55442,50.456245],[-3.558624,50.455948],[-3.555107,50.455425],[-3.552361,50.456112],[-3.553562,50.455235],
          [-3.553776,50.45529],[-3.552018,50.457123],[-3.557637,50.456356],[-3.549012,50.456356],[-3.544464,50.45794],[-3.547381,50.456276],[-3.547982,50.456764],
          [-3.552315,50.45671],[-3.545794,50.45663],[-3.54472,50.45606],[-3.54379,50.45703],[-3.5421,50.45789],[-3.541932,50.45805],[-3.541546,50.458298],
          [-3.542103,50.458267],[-3.540945,50.458405],[-3.54118,50.45886],[-3.54089,50.45964],[-3.53957,50.46092],[-3.53694,50.46197],[-3.5343,50.46237],
          [-3.53304,50.46243],[-3.53116,50.46256],[-3.52835,50.46032],[-3.52742,50.4605],[-3.527812,50.461384],[-3.52584,50.4606],[-3.529356,50.461437],
          [-3.528755,50.46231],[-3.52568,50.45819],[-3.522793,50.45745],[-3.52308,50.45731],[-3.5209,50.4561],[-3.51975,50.45459],[-3.51723,50.45446],
          [-3.51523,50.45379],[-3.51345,50.4544],[-3.50863,50.45733],[-3.50536,50.4588],[-3.50107,50.45928],[-3.49573,50.45905],[-3.49074,50.45805],
          [-3.48738,50.46032],[-3.48441,50.45976],[-3.48297,50.46006],[-3.48254,50.46039],[-3.4823,50.46082],[-3.48219,50.46104],[-3.48226,50.46129],[-3.48243,50.46157],
          [-3.48238,50.46167],[-3.48207,50.46188],[-3.48189,50.46196],[-3.48163,50.46203],[-3.48173,50.46213],[-3.48158,50.46226],[-3.48153,50.46231],
          [-3.48135,50.46241],[-3.48141,50.46268],[-3.48105,50.46303],[-3.48058,50.46341],[-3.48055,50.46357],[-3.48053,50.46369],[-3.48087,50.46408],
          [-3.48108,50.46417],[-3.48157,50.4643],[-3.48209,50.46397],[-3.48237,50.46383],[-3.48255,50.46347],[-3.48284,50.46333],[-3.48307,50.46331],
          [-3.48347,50.46347],[-3.48413,50.46342],[-3.48479,50.46338],[-3.48545,50.46343],[-3.48632,50.46326],[-3.48676,50.46333],[-3.48731,50.46358],
          [-3.48748,50.46359],[-3.48885,50.46396],[-3.48953,50.46444],[-3.48998,50.46494],[-3.49023,50.46548],[-3.49065,50.46611],[-3.49078,50.46622],
          [-3.49086,50.46654],[-3.49038,50.46688],[-3.49056,50.46718],[-3.4904,50.46737],[-3.49025,50.4678],[-3.49049,50.46828],[-3.49034,50.46872],
          [-3.49042,50.46895],[-3.4904,50.46915],[-3.49057,50.46943],[-3.49104,50.46964],[-3.49151,50.46988],[-3.49168,50.47001],[-3.49185,50.4702],
          [-3.49133,50.47036],[-3.49146,50.47045],[-3.49201,50.47053],
          [-3.49234,50.47032],[-3.49309,50.47011],[-3.49387,50.47014],[-3.49453,50.47052],[-3.49486,50.4705],[-3.49514,50.47097],[-3.49573,50.47095],
          [-3.49636,50.47143],[-3.49699,50.47144],[-3.49778,50.47108],[-3.49847,50.47128],[-3.49951,50.47135],[-3.50021,50.47182],[-3.50043,50.47189],
          [-3.5009,50.47201],[-3.50091,50.4723],[-3.50079,50.47246],[-3.50082,50.47273],[-3.50104,50.47279],[-3.50152,50.47285],[-3.50199,50.47308],
          [-3.50207,50.47349],[-3.50163,50.47388],[-3.50148,50.47423],[-3.5011,50.47459],[-3.50051,50.47491],[-3.49966,50.47513],[-3.49901,50.47535],
          [-3.49856,50.47532],[-3.49834,50.47553],[-3.49747,50.47576],[-3.49727,50.47593],[-3.49777,50.47608],[-3.49882,50.4763],[-3.49923,50.47651],
          [-3.49969,50.47664],[-3.50029,50.477],[-3.50055,50.47701],[-3.50077,50.47707],[-3.50125,50.47705],[-3.50151,50.47744],[-3.50224,50.47751],
          [-3.50245,50.47762],[-3.50317,50.47779],[-3.50359,50.47805],[-3.50399,50.47815],[-3.50431,50.47851],[-3.50476,50.47892],[-3.50551,50.47924],
          [-3.50596,50.47932],[-3.50668,50.47948],[-3.50707,50.47951],[-3.50771,50.47944],[-3.50813,50.47947],[-3.50843,50.47937],[-3.50871,50.47915],
          [-3.50912,50.47906],[-3.50954,50.47906],[-3.51021,50.47918],[-3.5108,50.47972],[-3.51118,50.47991],[-3.5123,50.47999],[-3.51278,50.48049],
          [-3.51412,50.48129],[-3.51475,50.48174],[-3.51516,50.4822],[-3.51512,50.4835],[-3.51473,50.48481],[-3.51481,50.48516],[-3.51435,50.48533],
          [-3.5139,50.48535],[-3.51302,50.48554],[-3.51277,50.48592],[-3.51291,50.48637],[-3.51319,50.48723],[-3.51335,50.48737],[-3.51345,50.48743],
          [-3.51425,50.48749],[-3.51464,50.48768],[-3.51464,50.48819],[-3.51475,50.48858],[-3.51417,50.48895],[-3.51393,50.48915],[-3.51418,50.48947],
          [-3.51413,50.48968],[-3.51408,50.49028],[-3.51377,50.49078],[-3.51397,50.4912],[-3.51383,50.49151],[-3.5133,50.49205],[-3.5132,50.49226],
          [-3.51327,50.49253],[-3.51368,50.49294],[-3.51346,50.49369],[-3.51345,50.49404],[-3.51351,50.49451],[-3.51335,50.49498],
          [-3.5136,50.49548],[-3.51398,50.49561],[-3.51415,50.49569],[-3.51536,50.4957],[-3.5155,50.49601],[-3.51522,50.49628],[-3.51339,50.49668],
          [-3.51306,50.49687],[-3.51303,50.49714],[-3.51389,50.49768],[-3.51399,50.49784],[-3.51348,50.49815],[-3.5129,50.49842],[-3.5128,50.49868],
          [-3.5128,50.49914],[-3.51253,50.49943],[-3.51271,50.49979],[-3.51263,50.49994],[-3.51252,50.50014],[-3.51238,50.50039],[-3.51212,50.50057],
          [-3.51245,50.50082],[-3.51253,50.50111],[-3.51296,50.50143],[-3.51287,50.50169],[-3.51298,50.50203],[-3.51296,50.5021],[-3.51284,50.50236],
          [-3.51315,50.5026],[-3.51281,50.50274],[-3.51228,50.5028],[-3.51277,50.50297],[-3.51298,50.50323],[-3.51292,50.50387],[-3.51263,50.50419],
          [-3.51272,50.50495],[-3.51291,50.50514],[-3.51315,50.50549],[-3.51334,50.50612],[-3.51315,50.50656],[-3.51245,50.50668],[-3.51179,50.50691],
          [-3.51133,50.50729],[-3.51105,50.50743],[-3.5109,50.50771],[-3.51103,50.50807],[-3.51136,50.50887],[-3.51157,50.50943],[-3.51178,50.50966],
          [-3.51163,50.50988],[-3.51113,50.51006],[-3.5113,50.51036],[-3.51156,50.51094],[-3.51105,50.51157],[-3.51091,50.51168],[-3.5102,50.51198],
          [-3.50984,50.51202],[-3.50961,50.5124],[-3.50959,50.51295],[-3.50983,50.51354],[-3.51014,50.51409],[-3.5099,50.51463],[-3.50926,50.51465],
          [-3.50872,50.51502],[-3.50866,50.51514],[-3.50855,50.51559],[-3.50868,50.51637],[-3.50909,50.5166],[-3.50911,50.51682],[-3.50891,50.51718],
          [-3.50868,50.51743],[-3.5084,50.51762],[-3.5079,50.51775],
          [-3.50786,50.51797],[-3.50788,50.51813],[-3.5081,50.51825],[-3.50811,50.51842],[-3.508,50.51858],[-3.50771,50.51896],[-3.50745,50.51915],
          [-3.5071,50.51921],[-3.50701,50.51925],[-3.5069,50.51977]]
        ]}}
    ]
  }
]

</script>

<script>
  Vue.component('ColoredBox', {
    template: '<div class="box"><button v-on:click="toggleMe()">Toggle Now</button></div>',
    methods: {
      toggleMe() {
        this.$root.toggleBox()
      }
    }
  })

  Vue.component('LeafletMap', {
    template: '<div class="wrapper"><div class="map" id="mapId"></div></div>',
    data() { return {
      catchments : CATCHMENTS,
      id: CATCHMENTID
     }
    },
    methods: {},
    mounted() { 
      const tiles = 
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
          maxZoom: 19,
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        }
      );

      const map = L.map('mapId').setView([51.505, -0.09], 13).addLayer(tiles);

      map.pm.addControls({
        /* position: 'topright', */
        drawMarker: true,
        drawRectangle: false,
        drawPolygon: true,
        drawCircle: false,
        drawCircleMarker: false,
        editMode: true,
        drawPolyline: false,
        removalMode: false,
        rotateMode:false
      });

      // Load the Catchment by Id
      const geoJsonSet = L.geoJson(this.catchments[this.id]);
	  
	  console.log("# of Polygon Pts:",this.catchments[this.id].features[0].geometry.coordinates[0].length)
	  
      geoJsonSet.addTo(map);
      map.fitBounds(geoJsonSet.getBounds());

      // set up the custom control
      const createButton = (text, onclick) => {
        const button = document.createElement('button');
        button.setAttribute('type', 'button');
        button.appendChild(document.createTextNode(text));
        L.DomEvent.on(button, 'click', onclick);
        return button;
      };

      // https://turfjs.org/docs/#convex
      const applyConvexHullFixButton = createButton('Convex Hull', (ev) => {  
        let polygon = turf.polygon(this.catchments[this.id].features[0].geometry.coordinates);
        let convextHull = turf.convex(polygon);

        console.log('applyConvexHullFixButton',convextHull)        
		console.log("# of Convex Pts:",convextHull.geometry.coordinates[0].length)


        const fixedCollection = L.geoJson(convextHull);
        fixedCollection.addTo(map);  
        geoJsonSet.remove();
      });

      // https://turfjs.org/docs/#concave
      const applyConcaveFixButton = createButton('Concave Hull', (ev) => {  
        let polygon = turf.polygon(this.catchments[this.id].features[0].geometry.coordinates);
        let options = {units: 'miles', maxEdge: 10};

        let concaveHull = turf.concave(polygon,options);
        console.log('applyConcaveFixButton',concaveHull);
        if(concaveHull != null) {
          const fixedCollection = L.geoJson(concaveHull);
        
          fixedCollection.addTo(map);  
          geoJsonSet.remove();
        }
        else alert("Concave Hull Failed!")
      });

      const applySmoothingFixButton = createButton('Smoothing', (ev) => {
        let polygon = turf.polygon(this.catchments[this.id].features[0].geometry.coordinates);

        // https://turfjs.org/docs/#simplify
        let options = {tolerance: 0.01, highQuality: false};
        let simplified = turf.simplify(polygon, options);	
        
        console.log('applySmoothingFixButton',simplified);
		console.log("# of Simplified Pts:",simplified.geometry.coordinates[0].length)
        if(simplified != null) {
          const fixedCollection = L.geoJson(simplified);
        
          fixedCollection.addTo(map);  
          geoJsonSet.remove();
        }
        else alert("Smoothing Failed!")
      });

      L.Control.FixControl = L.Control.extend({
	      onAdd: (map) => {
	        const fixToolBar = document.createElement('div');
          fixToolBar.appendChild(applyConvexHullFixButton);
          fixToolBar.appendChild(document.createElement('br'))
          fixToolBar.appendChild(applyConcaveFixButton);
          fixToolBar.appendChild(document.createElement('br'))
          fixToolBar.appendChild(applySmoothingFixButton);
	  
  	      return fixToolBar;
	      },
	      onRemove: (map) => {}
      });
  
      L.Control.fixControl = function(opts) {
        return new L.Control.FixControl(opts);
      };  
      L.Control.fixControl({ position: 'topleft' }).addTo(map);
    }
  })
  
  Vue.component('MyButton', {
    data: function () { return { count: 0 }},
    template: '<button v-on:click="count++">hit clicked {{ count }} times.</button>'
  })

  const vueApp = new Vue({
    el: '#app',
    data: { display: 'redbox' },
    methods: {
      toggleBox() {
        this.display == 'redbox' ? this.display = 'greenbox' : this.display = 'redbox'
      }
    }
  })
</script>

</body>
</html>