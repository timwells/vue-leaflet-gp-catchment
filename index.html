<!DOCTYPE >
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Leaflet Geoman Edit Demo</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@latest/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.css" />
<style>
html,
body { font-family: Arial, Verdana; background-color: #eef1ef; font-size: 16px; }
html,
body { width: 100%; height: 100%; margin: 0;}
.wrapper { width: 100%; }
.map { height: 100%; }

</style>

  </head>
  <body>
    <div class="wrapper">
       <div class="map" id="example2"></div>
    </div>
    <script src="https://unpkg.com/leaflet@latest/dist/leaflet.js"></script>
    <script src="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.min.js"></script>
<script>
	
const tiles1 = L.tileLayer(
  'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
  {
    maxZoom: 19,
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
  }
);

const map2 = L.map('example2').setView([51.505, -0.09], 13).addLayer(tiles1);

// https://github.com/geoman-io/leaflet-geoman
map2.pm.addControls({
  /* position: 'topright', */
  drawMarker: true,
  drawRectangle: false,
  drawPolygon: true,
  drawCircle: false,
  drawCircleMarker: false,
  editMode: true,
  drawPolyline: false,
  removalMode: false,
  rotateMode:false
});

/*
map2.pm.enableDraw('Polygon', { 
  allowSelfIntersection: false,
  allowSelfIntersectionEdit: false
});
*/
map2.off('click');
map2.on('pm:globaleditmodetoggled',  (e) => {
	console.log(e);
 });

// GEOSJON EXAMPLE
/*
const geoJsonData = {
  type: 'FeatureCollection',
  features: [{
      type: 'Feature',
      properties: {},
      geometry: {
        type: 'Polygon',
        coordinates: [
          [
            [-0.15369, 51.486973, 77],
            [-0.153853, 51.48686, 77],
            [-0.154183, 51.486968, 77],
            [-0.154001, 51.487087, 77],
            [-0.15369, 51.486973, 77],
          ],
        ],
      },
    },
  ],
};
*/

const geoJsonData = {
"type":"FeatureCollection",
	"features":[
		{"type":"Feature",
			"properties":{"DCORegion":"Q79","stroke-opacity":1,"OrgLongitude":"1.162381","OrgLatitude":"52.057365","name":"D83074 - ORCHARD MEDICAL PRACTICE","Region":"Y55","CCGCode":"06L","ODSCode":"D83074","fill-opacity":0,"stroke":"#0000FF"},
			"geometry":{
				"type":"Polygon",
				"coordinates":[[[1.14189,52.05168],[1.14139,52.05189],[1.1409,52.05305],[1.14,52.0541],[1.13886,52.05427],[1.13785,52.05404],[1.13684,52.05433],[1.13508,52.05586],[1.13519,52.05658],[1.13472,52.05729],[1.13448,52.05743],[1.13453,52.05978],[1.13463,52.06311],[1.1409,52.06497],[1.14103,52.06522],[1.14111,52.06528],[1.14178,52.06527],[1.14081,52.06531],[1.14094,52.06507],[1.14167,52.06449],[1.14145,52.06528],[1.14137,52.06473],[1.13494,52.06309],[1.15227,52.07892],[1.16266,52.08087],[1.16849,52.08129],[1.17433,52.08143],[1.19836,52.08024],[1.20338,52.08013],[1.20819,52.08011],[1.21828,52.08035],[1.23059,52.07755],[1.23411,52.07652],[1.23806,52.07602],[1.23016,52.07726],[1.23085,52.07739],[1.23133,52.07718],[1.24428,52.07457],[1.24385,52.06654],[1.24286,52.06315],[1.23931,52.05892],[1.23995,52.05283],[1.25325,52.05006],[1.25877,52.04561],[1.25467,52.03821],[1.25591,52.041],[1.25351,52.03567],[1.25574,52.04069],[1.25608,52.04061],[1.25385,52.04597],[1.25357,52.04535],[1.24643,52.04663],[1.23986,52.05294],[1.24647,52.0466],[1.26119,52.04346],[1.25484,52.03813],[1.2551,52.03892],[1.25879,52.04594],[1.25372,52.03535],[1.25394,52.03561],[1.25845,52.03464],[1.25767,52.03179],[1.25707,52.02918],[1.25536,52.02693],[1.2533,52.02656],[1.24918,52.02778],[1.24506,52.02788],[1.24257,52.02754],[1.23999,52.02672],[1.23398,52.02461],[1.23188,52.02421],[1.22978,52.02416],[1.22789,52.0244],[1.2218,52.02537],[1.21888,52.02564],[1.21549,52.02572],[1.20759,52.02537],[1.19742,52.02376],[1.1945,52.02347],[1.19068,52.02342],[1.18725,52.02384],[1.18394,52.0245],[1.17965,52.02617],[1.17725,52.0267],[1.17422,52.02693],[1.1705,52.03149],[1.15952,52.03346],[1.15976,52.03377],[1.15918,52.0338],[1.15998,52.03404],[1.16007,52.03406],[1.16127,52.03419],[1.16057,52.03381],[1.16017,52.03384],[1.16009,52.03388],[1.15566,52.0364],[1.157167,52.046473],[1.148587,52.051118],[1.15116,52.054179],[1.147729,52.05154],[1.152705,52.04869],[1.143268,52.054602],[1.150989,52.048479],[1.148758,52.047423],[1.148758,52.04774],[1.153048,52.052174],[1.151161,52.04679],[1.14773,52.053335],[1.152533,52.044362],[1.15339,52.044467],[1.143441,52.053757],[1.154076,52.044573],[1.152703,52.044573],[1.153047,52.04415],[1.153047,52.044678],[1.155276,52.044995],[1.153903,52.044467],[1.153218,52.044467],[1.148238,52.046104],[1.153471,52.04642],[1.149953,52.044731],[1.151497,52.047107],[1.149438,52.044731],[1.154594,52.051224],[1.154242,52.04415],[1.15184,52.045417],[1.154413,52.044889],[1.149781,52.044995],[1.153556,52.04415],[1.154933,52.044784],[1.154246,52.045628],[1.152188,52.044467],[1.146531,52.051118],[1.138123,52.055341],[1.141726,52.054179],[1.153388,52.044889],[1.153388,52.044678],[1.152698,52.044784],[1.153388,52.044362],[1.153731,52.044889],[1.155104,52.044362],[1.154247,52.044784],[1.156305,52.047212],[1.154585,52.044573],[1.152874,52.045312],[1.154761,52.044256],[1.145672,52.053757],[1.153045,52.044889],[1.153384,52.044784],[1.144128,52.053652],[1.153212,52.044467],[1.152869,52.044678],[1.153898,52.044995],[1.149782,52.044678],[1.153732,52.045206],[1.153383,52.044467],[1.149437,52.044731],[1.153391,52.052913],[1.149094,52.045523],[1.150639,52.046367],[1.149609,52.047001],[1.149008,52.046948],[1.150296,52.044678],[1.151067,52.046579],[1.147037,52.04774],[1.149695,52.045523],[1.150037,52.045153],[1.151068,52.047423],[1.141807,52.052121],[1.146696,52.051277],[1.143265,52.051857],[1.146353,52.051118],[1.14601,52.05096],[1.148068,52.049799],[1.14655,52.0486],[1.148841,52.050907],[1.149437,52.047846],[1.149269,52.046631],[1.151582,52.04737],[1.141377,52.053018],[1.152096,52.044573],[1.151067,52.045734],[1.150037,52.047529],[1.148923,52.047265],[1.148322,52.047582],[1.149781,52.045734],[1.147122,52.047529],[1.150382,52.05096],[1.150469,52.050274],[1.150898,52.050643],[1.14558,52.051593],[1.140778,52.053652],[1.14637,52.04904],[1.1474,52.0496],[1.14916,52.04977],[1.15081,52.0501],[1.15114,52.05047],[1.15262,52.05077],[1.15315,52.05159],[1.15047,52.05131],[1.14601,52.05123],[1.14298,52.05183],[1.14189,52.05168],
					[1.14189,52.05168]]]
			}
		}
	]
};


// https://jsfiddle.net/ygLp7xd1/
//var geoJsonData = L.geoJSON().addTo(map2);
//geoJsonData.addData({"type":"Polygon","coordinates":[[[4.677076,49.003375],[4.345093,48.770672],[4.858284,48.616297],[5.286592,48.703378],[5.412889,48.529065],[4.822592,48.677995],[5.168533,48.793928],[5.281101,48.886121],[4.655112,48.826486],[4.333881,48.601769],[4.281715,49.019589],[4.677076,49.003375]]]});
//map2.fitBounds(geoJsonData.getBounds());

// D83074
/*
var geoJsonData = L.geoJSON().addTo(map2);
geoJsonData.addData({
"type":"FeatureCollection",
"features":[{
	"type":"Feature",
	"properties":{"DCORegion":"Q79","stroke-opacity":1,"OrgLongitude":"1.162381","OrgLatitude":"52.057365","name":"D83074 - ORCHARD MEDICAL PRACTICE","Region":"Y55","CCGCode":"06L","ODSCode":"D83074","fill-opacity":0,"stroke":"#0000FF"},
	"geometry":{
		"type":"Polygon",
		"coordinates":[[[1.14189,52.05168],[1.14139,52.05189],[1.1409,52.05305],[1.14,52.0541],[1.13886,52.05427],[1.13785,52.05404],[1.13684,52.05433],[1.13508,52.05586],[1.13519,52.05658],[1.13472,52.05729],[1.13448,52.05743],[1.13453,52.05978],[1.13463,52.06311],[1.1409,52.06497],[1.14103,52.06522],[1.14111,52.06528],[1.14178,52.06527],[1.14081,52.06531],[1.14094,52.06507],[1.14167,52.06449],[1.14145,52.06528],[1.14137,52.06473],[1.13494,52.06309],[1.15227,52.07892],[1.16266,52.08087],[1.16849,52.08129],[1.17433,52.08143],[1.19836,52.08024],[1.20338,52.08013],[1.20819,52.08011],[1.21828,52.08035],[1.23059,52.07755],[1.23411,52.07652],[1.23806,52.07602],[1.23016,52.07726],[1.23085,52.07739],[1.23133,52.07718],[1.24428,52.07457],[1.24385,52.06654],[1.24286,52.06315],[1.23931,52.05892],[1.23995,52.05283],[1.25325,52.05006],[1.25877,52.04561],[1.25467,52.03821],[1.25591,52.041],[1.25351,52.03567],[1.25574,52.04069],[1.25608,52.04061],[1.25385,52.04597],[1.25357,52.04535],[1.24643,52.04663],[1.23986,52.05294],[1.24647,52.0466],[1.26119,52.04346],[1.25484,52.03813],[1.2551,52.03892],[1.25879,52.04594],[1.25372,52.03535],[1.25394,52.03561],[1.25845,52.03464],[1.25767,52.03179],[1.25707,52.02918],[1.25536,52.02693],[1.2533,52.02656],[1.24918,52.02778],[1.24506,52.02788],[1.24257,52.02754],[1.23999,52.02672],[1.23398,52.02461],[1.23188,52.02421],[1.22978,52.02416],[1.22789,52.0244],[1.2218,52.02537],[1.21888,52.02564],[1.21549,52.02572],[1.20759,52.02537],[1.19742,52.02376],[1.1945,52.02347],[1.19068,52.02342],[1.18725,52.02384],[1.18394,52.0245],[1.17965,52.02617],[1.17725,52.0267],[1.17422,52.02693],[1.1705,52.03149],[1.15952,52.03346],[1.15976,52.03377],[1.15918,52.0338],[1.15998,52.03404],[1.16007,52.03406],[1.16127,52.03419],[1.16057,52.03381],[1.16017,52.03384],[1.16009,52.03388],[1.15566,52.0364],[1.157167,52.046473],[1.148587,52.051118],[1.15116,52.054179],[1.147729,52.05154],[1.152705,52.04869],[1.143268,52.054602],[1.150989,52.048479],[1.148758,52.047423],[1.148758,52.04774],[1.153048,52.052174],[1.151161,52.04679],[1.14773,52.053335],[1.152533,52.044362],[1.15339,52.044467],[1.143441,52.053757],[1.154076,52.044573],[1.152703,52.044573],[1.153047,52.04415],[1.153047,52.044678],[1.155276,52.044995],[1.153903,52.044467],[1.153218,52.044467],[1.148238,52.046104],[1.153471,52.04642],[1.149953,52.044731],[1.151497,52.047107],[1.149438,52.044731],[1.154594,52.051224],[1.154242,52.04415],[1.15184,52.045417],[1.154413,52.044889],[1.149781,52.044995],[1.153556,52.04415],[1.154933,52.044784],[1.154246,52.045628],[1.152188,52.044467],[1.146531,52.051118],[1.138123,52.055341],[1.141726,52.054179],[1.153388,52.044889],[1.153388,52.044678],[1.152698,52.044784],[1.153388,52.044362],[1.153731,52.044889],[1.155104,52.044362],[1.154247,52.044784],[1.156305,52.047212],[1.154585,52.044573],[1.152874,52.045312],[1.154761,52.044256],[1.145672,52.053757],[1.153045,52.044889],[1.153384,52.044784],[1.144128,52.053652],[1.153212,52.044467],[1.152869,52.044678],[1.153898,52.044995],[1.149782,52.044678],[1.153732,52.045206],[1.153383,52.044467],[1.149437,52.044731],[1.153391,52.052913],[1.149094,52.045523],[1.150639,52.046367],[1.149609,52.047001],[1.149008,52.046948],[1.150296,52.044678],[1.151067,52.046579],[1.147037,52.04774],[1.149695,52.045523],[1.150037,52.045153],[1.151068,52.047423],[1.141807,52.052121],[1.146696,52.051277],[1.143265,52.051857],[1.146353,52.051118],[1.14601,52.05096],[1.148068,52.049799],[1.14655,52.0486],[1.148841,52.050907],[1.149437,52.047846],[1.149269,52.046631],[1.151582,52.04737],[1.141377,52.053018],[1.152096,52.044573],[1.151067,52.045734],[1.150037,52.047529],[1.148923,52.047265],[1.148322,52.047582],[1.149781,52.045734],[1.147122,52.047529],[1.150382,52.05096],[1.150469,52.050274],[1.150898,52.050643],[1.14558,52.051593],[1.140778,52.053652],[1.14637,52.04904],[1.1474,52.0496],[1.14916,52.04977],[1.15081,52.0501],[1.15114,52.05047],[1.15262,52.05077],[1.15315,52.05159],[1.15047,52.05131],[1.14601,52.05123],[1.14298,52.05183],[1.14189,52.05168],
					[1.14189,52.05168]]]
		}
	}
]});
map2.fitBounds(geoJsonData.getBounds());
*/

/*
geoJsonData.pm.enable({ 
 allowSelfIntersection: false,
 allowSelfIntersectionEdit: true
});
*/
/*
map2.pm.enable({ 
 allowSelfIntersection: false,
 allowSelfIntersectionEdit: true
});
*/

const theCollection = L.geoJson(geoJsonData);
theCollection.addTo(map2);

const b = theCollection.getBounds();
map2.fitBounds(b);

theCollection.on('pm.create',(e) => {
  e.layer.pm.enable({ 
	allowSelfIntersection: false,
	allowSelfIntersectionEdit: true
  })
});

theCollection.on('pm:edit', (e) => {
  e.layer.pm.enable({ 
	allowSelfIntersection: false,
	allowSelfIntersectionEdit: true
  });
  //console.log(e.layer.pm.hasSelfIntersection());
});

theCollection.on('pm:dragstart', (e) => { console.log(e); });	
	</script>
  </body>
</html>
